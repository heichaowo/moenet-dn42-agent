# DN42 BGP Peer Configuration
# Peer: AS{{ peer.asn }} ({{ peer.name }})

protocol bgp dn42_{{ peer.asn }} from dn42_peer {
{% if peer.contact %}
    description "{{ peer.contact }}";
{% endif %}
    neighbor {{ peer.bgp.dn42_ipv6 or peer.bgp.dn42_ipv4 }} as {{ peer.asn }};
{% if peer.bgp.dn42_ipv6 and (peer.bgp.dn42_ipv6|lower)[:6] == 'fe80::' %}
    interface "dn42-{{ peer.asn }}";
{% if peer.bgp.request_lla %}
    source address {{ peer.bgp.request_lla }};
{% endif %}
{% endif %}
{% if peer.bgp.mpbgp %}
    # MP-BGP enabled
{% if peer.bgp.dn42_ipv4 and peer.bgp.dn42_ipv6 %}
    ipv4 { import filter dn42_import_filter; export filter dn42_export_filter; {% if peer.bgp.extended_nexthop %}extended next hop on; {% endif %}};
    ipv6 { import filter dn42_import_filter; export filter dn42_export_filter; };
{% elif peer.bgp.dn42_ipv4 %}
    ipv4 { import filter dn42_import_filter; export filter dn42_export_filter; };
{% else %}
    ipv6 { import filter dn42_import_filter; export filter dn42_export_filter; };
{% endif %}
{% else %}
    # Single protocol (no MP-BGP)
{% if peer.bgp.dn42_ipv4 %}
    ipv4 { import filter dn42_import_filter; export filter dn42_export_filter; };
{% else %}
    ipv6 { import filter dn42_import_filter; export filter dn42_export_filter; };
{% endif %}
{% endif %}
}
